---
title: "PhysReproDataPrep"
author: "Ashlee Mikkelsen"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This Rmarkdownd will go through data prep for analysis of the physiological indicators of reproduction in brown bears (*Ursus arctos arctos*) in Sweden

```{r load packages, include=FALSE}
# clear workspace and load packages
rm(list = ls())


library(readxl)
library(dplyr)
library(ggplot2)
library(viridis)

```

```{r load data, include=FALSE}

rawdata <- read_excel("RawBearData_SI_CORT.xlsx")
str(rawdata)


```

So I have my raw data loaded and it needs a lot of work to be usable for analysis. I need to correct the cortisol for the difference between extraction kits. I need to correct the 13C for the Suess effect, I need to extract the females from this files and I need to determine how many NAs are present and what to do with them. Do I remove them or do I populate their missing data?

I guess the first step will be correcting the cortisol. This means that I need to use the equation published in Wilson et al. 2021. Now this analysis is focused only on females, so I guess it actually makes more sense to first isolate females, then apply the female specific correction rather than the general correction to my data.

$$
cortisol from kit 2 = 1.98 + (0.89 * cortisol from kit 1)
$$

```{r isolate females and correct cortisol}

bears.fem <- subset(rawdata, sex=="F")

kit <- bears.fem$cort.kit
print(kit)
cort.raw <- as.numeric(bears.fem$cortisol)
cort.corrected <- c()

df <-cbind(kit,cort.raw, cort.corrected)

kit1correction <- function(x,y){
  y=1.98+(0.89*x)
}

kit2correction <- function(x,y){
  y=x*1
}

for (i in kit) {
  cort.corrected <- paste(kit1correction(cort.raw))
}

for (i in df) {
  if(i="1"){
    cort.corrected <- paste(kit1correction(cort.raw))
  }
}

```

The first step is to correct the 𝛅13C values for the Suess effect due to human burning of fossil fuels. Following Chamerlain *et al.* 2005, I use a time-dependent correction of -0.022‰ for each year up to the last year in my data set.

```{r}

LastYr <- max(bearhairisotopes$year)

bearhairisotopes$C13.suess <- bearhairisotopes$C13-(-0.022*(LastYr-bearhairisotopes$year))

P2 <- palette(viridis(4))

ggplot(data = bearhairisotopes)+
  geom_jitter(aes(year,C13), color=P2[1], alpha=0.5, width = 0.3)+
  geom_jitter(aes(year, C13.suess), color=P2[2],alpha=0.5,width = 0.3)+
  geom_smooth(aes(year,C13), lwd=1, color=P2[1], fill=P2[1], method = "lm", alpha=0.2)+
  geom_smooth(aes(year,C13.suess),lwd=2, color=P2[2], fill=P2[2], method = "lm", alpha=0.25)+
  geom_text(label="With Suess Correction", colour=P2[2], x=2006, y=-21.5, size=6.5)+
  geom_text(label="Without Correction", colour=P2[1], x=2006, y=-21.6, size=6)+
  theme_classic()


```

Next, this analysis is going to focus on reproduction, so I only want to look at females

```{r}

ReproIsotopes <- subset(bearhairisotopes, sex!="M")


```

This analysis will also focus on cortisol concentrations extracted from brown bear hair

```{r}



```
